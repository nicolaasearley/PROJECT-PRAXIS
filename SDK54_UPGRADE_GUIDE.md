# Expo SDK 52 â†’ SDK 54 Upgrade Guide

## âœ… Phase 1: JS-Level Dependencies - COMPLETE

**Changes Made:**
- Updated `expo`: `~53.0.0` â†’ `^55.0.0` (SDK 54)
- Updated `react`: `19.1.0` â†’ `18.3.1` (SDK 54 requirement)
- Updated `react-dom`: `19.1.0` â†’ `18.3.1`
- Updated `react-native`: `0.79.6` â†’ `0.76.0` (SDK 54)
- Updated `expo-router`: `~5.1.4` â†’ `^4.0.7` (SDK 54)
- Updated `react-native-reanimated`: `~3.17.4` â†’ `~3.12.0` (SDK 54 compatible)
- Updated `react-native-gesture-handler`: `~2.20.0` â†’ `~2.16.2`
- Updated `react-native-screens`: `~4.16.0` â†’ `~4.8.4`
- Updated `react-native-safe-area-context`: `^5.4.0` â†’ `4.10.5`
- Updated all Expo packages to SDK 54 compatible versions
- Added `expo-splash-screen`: `~0.26.4`
- Updated dev dependencies (`jest-expo`, `eslint-config-expo`, `@types/react`, `react-test-renderer`)

**Why:** SDK 54 uses React 18.3.1 and React Native 0.76.0, which are stable and well-tested versions. All Expo packages must match SDK 54's compatibility matrix.

## âœ… Phase 2: App Config - COMPLETE

**Changes Made:**
- Added `jsEngine: 'hermes'` to `app.config.ts`

**Why:** Explicitly sets Hermes as the JavaScript engine, which is the default and recommended for SDK 54.

## âœ… Phase 3: Metro Config - VERIFIED

**Status:** Already correct
- Uses `getDefaultConfig` from `expo/metro-config`
- Includes `unstable_allowRequireContext: true` for compatibility

## âœ… Phase 4: Babel Config - VERIFIED

**Status:** Already correct
- `react-native-reanimated/plugin` is present at the end of plugins array
- This is required for Reanimated to work with Fabric

## ðŸ”„ Phase 5: Native Rebuild - REQUIRED (Run These Commands)

**IMPORTANT:** The iOS native folder contains corrupted Folly coroutine workarounds from SDK 52. These must be completely removed and regenerated.

### Step 1: Delete Native Directories

```bash
cd praxis-app
rm -rf ios android
```

**Why:** Removes all corrupted native code, Folly hacks, and SDK 52 artifacts.

### Step 2: Remove Lockfiles

```bash
rm -rf yarn.lock package-lock.json pnpm-lock.yaml
```

**Why:** Ensures fresh dependency resolution with SDK 54 versions.

### Step 3: Install Dependencies

```bash
npm install
```

**Why:** Installs all SDK 54 compatible packages.

### Step 4: Clear Expo Cache and Regenerate Native Files

```bash
npx expo prebuild --clean
```

**Why:** 
- `--clean` flag removes all cached native files
- Generates fresh iOS/Android folders with SDK 54 defaults
- Creates clean Podfile with ZERO Folly overrides

### Step 5: Install iOS Pods

```bash
cd ios
rm -rf Pods Podfile.lock build
pod install
cd ..
```

**Why:** 
- Removes old pods from SDK 52
- Installs fresh pods for SDK 54
- Should complete with 0 errors (no Folly coroutine issues)

### Step 6: Verify Podfile is Clean

After `pod install`, verify `ios/Podfile` contains:
- âœ… No `FOLLY_HAS_COROUTINES` definitions
- âœ… No `FOLLY_CFG_NO_COROUTINES` definitions
- âœ… No custom stub header creation code
- âœ… No preprocessor overrides
- âœ… Only standard Expo SDK 54 `post_install` hook

### Step 7: Build and Test

```bash
npx expo start --clear
# In another terminal:
npx expo run:ios
```

**Why:** 
- `--clear` clears Metro bundler cache
- `run:ios` builds with fresh native code
- Should build successfully without Folly errors

## Expected Results

After completing all phases:

1. âœ… **No Folly coroutine errors** - SDK 54's React Native 0.76.0 doesn't have the coroutine issues from 0.81.5
2. âœ… **Clean Podfile** - No manual hacks or overrides
3. âœ… **Reanimated works with Fabric** - Version 3.12.0 is compatible
4. âœ… **Hermes enabled** - Explicitly configured in app.config.ts
5. âœ… **All Expo modules load** - SDK 54 compatibility ensured

## Troubleshooting

### If `pod install` fails:
```bash
cd ios
rm -rf Pods Podfile.lock ~/Library/Caches/CocoaPods
pod cache clean --all
pod install --repo-update
```

### If build errors persist:
```bash
# Nuclear option - complete clean
rm -rf ios android node_modules package-lock.json
npm install
npx expo prebuild --clean
cd ios && pod install && cd ..
```

### Verify SDK version:
```bash
npx expo-doctor
```

This will check for version mismatches and suggest fixes.

## Files Modified

- âœ… `praxis-app/package.json` - All dependencies updated to SDK 54
- âœ… `praxis-app/app.config.ts` - Added `jsEngine: 'hermes'`
- âœ… `praxis-app/metro.config.js` - Verified correct (no changes needed)
- âœ… `praxis-app/babel.config.js` - Verified correct (no changes needed)

## Files That Will Be Regenerated

- `ios/` - Will be completely regenerated by `expo prebuild --clean`
- `android/` - Will be completely regenerated by `expo prebuild --clean`
- `ios/Podfile` - Will be regenerated with SDK 54 defaults (no Folly hacks)

## Key Differences: SDK 52 â†’ SDK 54

1. **React Native**: 0.81.5 â†’ 0.76.0 (more stable, no Folly coroutine issues)
2. **React**: 19.1.0 â†’ 18.3.1 (SDK 54 requirement)
3. **Reanimated**: 3.17.4 â†’ 3.12.0 (SDK 54 compatible version)
4. **No Folly hacks needed** - SDK 54's RN 0.76.0 doesn't have the coroutine header issues
5. **Cleaner native setup** - Expo SDK 54 has better native module integration

---

**Status:** âœ… All JS-level changes complete. Ready for native rebuild.
